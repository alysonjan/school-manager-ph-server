import{q as L,r as a,j as s,t as c,T as u,I,v as z,w as A,x as F,L as O}from"./index-CguHGk5K.js";import{C as q}from"./config-global-C1bjA4IF.js";import{T as j}from"./TextField-BHvFdFV8.js";function N(){const b=L(),[l,R]=a.useState(""),[p,T]=a.useState(!1),[w,W]=a.useState(!1),[d,E]=a.useState(""),[m,B]=a.useState(""),[r,f]=a.useState({}),[i,k]=a.useState({}),[t,C]=a.useState(!1),v=a.useCallback(()=>{const e={};return l.trim()||(e.username="Username is required"),d?d.length<8?e.password="Password must be at least 8 characters":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(d)||(e.password="Password must contain uppercase, lowercase, and numbers"):e.password="Password is required",m?m!==d&&(e.confirmPassword="Passwords do not match"):e.confirmPassword="Please confirm your password",f(e),e},[l,d,m]),h=a.useCallback((e,n)=>{const o={...r};switch(e){case"username":n.trim()?delete o.username:o.username="Username is required";break;case"password":n?n.length<8?o.password="Password must be at least 8 characters":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(n)?delete o.password:o.password="Password must contain uppercase, lowercase, and numbers":o.password="Password is required";break;case"confirmPassword":n?n!==d?o.confirmPassword="Passwords do not match":delete o.confirmPassword:o.confirmPassword="Please confirm your password";break}f(o)},[r,d]),g=a.useCallback(async()=>{k({username:!0,password:!0,confirmPassword:!0});const n=v();if(!(Object.keys(n).length>0)){C(!0);try{console.log("Password reset attempt:",{username:l}),await new Promise(x=>setTimeout(x,1e3)),f(x=>({...x,success:`Password successfully reset for ${l}!`})),setTimeout(()=>{b.push("/login")},1500)}catch(x){console.error("Password reset failed:",x),f(M=>({...M,submit:"Failed to reset password. Please try again."}))}finally{C(!1)}}},[l,b,v]),P=a.useCallback(e=>{e.key==="Enter"&&!t&&g()},[g,t]),y=a.useCallback(e=>n=>{const o=n.target.value;switch(e){case"username":R(o);break;case"password":E(o);break;case"confirmPassword":B(o);break}i[e]&&h(e,o)},[i,h]),S=a.useCallback(e=>()=>{k(n=>({...n,[e]:!0})),h(e,e==="username"?l:e==="password"?d:m)},[l,d,m,h]);return s.jsx(c,{sx:{position:"fixed",inset:0,display:"flex",alignItems:"flex-start",justifyContent:"center",bgcolor:"#f4f6f8",px:{xs:1,sm:0},pt:{xs:5,sm:4},pb:{xs:1,sm:4},height:"100vh",overflow:"hidden"},children:s.jsxs(c,{sx:{bgcolor:"#fff",p:{xs:3,sm:5},borderRadius:{xs:2,sm:3},boxShadow:"0 4px 16px rgba(0,0,0,0.08)",width:"100%",maxWidth:{xs:"calc(100vw - 32px)",sm:420},mx:"auto",mt:{xs:0,sm:2},maxHeight:{xs:"calc(100vh - 32px)",sm:"auto"},overflow:"hidden"},children:[s.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:{xs:3,sm:4}},children:[s.jsx(c,{component:"img",src:"/assets/images/school-logo.png",alt:"School Logo",sx:{width:{xs:60,sm:75},height:"auto",mr:{xs:1,sm:1.5}}}),s.jsxs(c,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"left",lineHeight:1.2},children:[s.jsx(u,{variant:"caption",sx:{color:"text.secondary",fontWeight:500,letterSpacing:.4,fontSize:{xs:10,sm:11}},children:"TaparSoft"}),s.jsx(u,{variant:"h6",sx:{fontWeight:700,fontSize:{xs:"1.1rem",sm:"1.25rem"}},children:"SchoolMANAGER"}),s.jsx(u,{variant:"subtitle2",sx:{fontWeight:600,color:"text.secondary",fontSize:{xs:9,sm:10},textAlign:"right",letterSpacing:.3,whiteSpace:"nowrap"},children:"School Management System"})]})]}),s.jsx(u,{variant:"h5",sx:{mb:{xs:2.5,sm:3.5},fontWeight:600,textAlign:"center",color:"text.primary",fontSize:{xs:"1rem",sm:"1.1rem"}},children:"Reset password"}),s.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:{xs:2,sm:2.5}},children:[s.jsx(j,{fullWidth:!0,label:i.username&&r.username?r.username:"Username",value:l,onChange:y("username"),onBlur:S("username"),onKeyPress:P,error:i.username&&!!r.username,disabled:t,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.2,fontSize:{xs:"0.9rem",sm:"1rem"}},"& .MuiInputLabel-root":{color:i.username&&r.username?"error.main":"text.secondary"}}}),s.jsx(j,{fullWidth:!0,label:i.password&&r.password?r.password:"New Password",type:p?"text":"password",value:d,onChange:y("password"),onBlur:S("password"),onKeyPress:P,error:i.password&&!!r.password,disabled:t,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.2,fontSize:{xs:"0.9rem",sm:"1rem"}},"& .MuiInputLabel-root":{color:i.password&&r.password?"error.main":"text.secondary"}},InputProps:{endAdornment:s.jsx(I,{position:"end",children:s.jsx(z,{onClick:()=>T(!p),size:"small",edge:"end","aria-label":p?"Hide password":"Show password",disabled:t,children:s.jsx(A,{icon:p?"solar:eye-bold":"solar:eye-closed-bold",width:20})})})}}),s.jsx(j,{fullWidth:!0,label:i.confirmPassword&&r.confirmPassword?r.confirmPassword:"Confirm Password",type:w?"text":"password",value:m,onChange:y("confirmPassword"),onBlur:S("confirmPassword"),onKeyPress:P,error:i.confirmPassword&&!!r.confirmPassword,disabled:t,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.2,fontSize:{xs:"0.9rem",sm:"1rem"}},"& .MuiInputLabel-root":{color:i.confirmPassword&&r.confirmPassword?"error.main":"text.secondary"}},InputProps:{endAdornment:s.jsx(I,{position:"end",children:s.jsx(z,{onClick:()=>W(!w),size:"small",edge:"end","aria-label":w?"Hide password":"Show password",disabled:t,children:s.jsx(A,{icon:w?"solar:eye-bold":"solar:eye-closed-bold",width:20})})})}}),r.success&&s.jsx(u,{color:"success.main",variant:"caption",sx:{display:"block",textAlign:"center",mt:1,fontSize:{xs:"0.75rem",sm:"0.8rem"},fontWeight:500,backgroundColor:"success.light",py:.5,px:2,borderRadius:1},children:r.success}),r.submit&&s.jsx(u,{color:"error",variant:"caption",sx:{display:"block",textAlign:"center",mt:1,fontSize:{xs:"0.75rem",sm:"0.8rem"},fontWeight:500},children:r.submit}),s.jsx(F,{fullWidth:!0,variant:"contained",size:"large",disabled:t,sx:{mt:{xs:1.2,sm:1.8},py:{xs:1.1,sm:1.4},fontWeight:600,borderRadius:1.8,textTransform:"none",boxShadow:"none",fontSize:{xs:"0.92rem",sm:"1rem"},"&:hover":{boxShadow:t?"none":"0 4px 12px rgba(0,0,0,0.15)"},"&.Mui-disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled"}},onClick:g,children:t?"RESETTING PASSWORD...":"SUBMIT"}),s.jsx(c,{sx:{textAlign:"center",mt:{xs:1.3,sm:1.8}},children:s.jsx(O,{variant:"body2",color:"text.secondary",sx:{cursor:"pointer",fontWeight:500,fontSize:{xs:"0.82rem",sm:"0.875rem"},"&:hover":{color:"primary.main"},...t&&{pointerEvents:"none",opacity:.5}},onClick:()=>!t&&b.push("/login"),children:"Back to Login"})})]})]})})}function D(){return s.jsxs(s.Fragment,{children:[s.jsx("title",{children:`Password Reset - ${q.appName}`}),s.jsx(N,{})]})}export{D as default};
